var EndNodeColor1="#f8feb0";var EndNodeColor2="#fad01e";var EndNodeColor1="#3f6";var EndNodeColor2="#38e100";var CurrentNodeColor1="#ffa6a6";var CurrentNodeColor2="#ff0000";var OrNodeColor="#92cddc";var NoStartNodeColor1="#e7e7e7";var NoStartNodeColor2="#d7d7d7";var goalClickStyle="";var goalPrvNode=new Array();var goalNextNode=new Array();function div1.onmousedown(){CancelPrvNextNode();if(event.srcElement.parentElement.id=="div1"||event.srcElement.parentElement.parentElement.id=="div1"){if(event.srcElement.parentElement.id=="div1"){var obj=event.srcElement}else{var obj=event.srcElement.parentElement}ChangeObjStyle(obj)}}function div1.onmouseup(){ChangeObjStyle()}function SetProperty(a,b){}function ChangeObjStyle(a){if(a){if(a.NodeType=="YNode"||a.NodeType=="XNode"||a.NodeType=="YNode_text"||a.NodeType=="XNode_text"){goalClickStyle="";return}if(goalClickStyle!=a.id){a.strokeweight+=1;a.style.zIndex="1200";goalClickStyle=a.id}}else{if(goalClickStyle!=""){try{var b=document.getElementById(goalClickStyle);b.strokeweight-=1;if(b.tagName=="polyline"){b.style.zIndex="1"}else{b.style.zIndex="10"}}catch(e){}goalClickStyle=""}}}function InitNode(){var a=document.all.length;var b=new Array();var j=0;for(i=0;i<a;i++){var c=document.all(i);if(c.tagName=="polyline"){b[j]=c;j=j+1}}for(i=0;i<b.length;i++){var c=b[i];if(c.oldpoints!=""){c.points.value=c.oldpoints}}if(document.all.div1.style.display=="none"){document.all.div1.style.display=""}for(var i=0;i<document.all.length;i++){var c=document.all(i);var d=c.tagName;if(c.NodeType=="StartNode"){c.fillcolor=EndNodeColor1;c.firstChild.color2=EndNodeColor2}if(EndNodeList!=""){if((","+EndNodeList+",").indexOf(","+c.Nodeid+",")!=-1){c.fillcolor=EndNodeColor1;c.firstChild.color2=EndNodeColor2}}if(CurrentNodeid!=""){if((","+CurrentNodeid+",").indexOf(","+c.Nodeid+",")!=-1){c.fillcolor=CurrentNodeColor1;c.firstChild.color2=CurrentNodeColor2;c.strokeweight=1.50}}if((c.NodeType=="SubProcess"||c.NodeType=="Activity"||c.NodeType=="AutoActivity")&&c.fillcolor==OrNodeColor){c.fillcolor=NoStartNodeColor1;c.firstChild.color2=NoStartNodeColor2}}}function ShowNextNode(a){var b=a.LinkeyStartObj;if(b!=""&&b!=undefined){var c=b.split(",");for(i=0;i<c.length;i++){var d=c[i].indexOf("_");var e=c[i].length;var f=c[i].substring(d+1,e);var g=eval("Node"+f);goalNextNode[goalNextNode.length]="Node"+f+"$$"+g.fillcolor+","+g.id+"$$"+g.firstChild.color2;g.fillcolor="#f8feb0";g.firstChild.color2="#fad01e"}}}function ShowPrvNode(a){var b=a.LinkeyEndObj;if(b!=""&&b!=undefined){var c=b.split(",");for(i=0;i<c.length;i++){var d=c[i].indexOf("polyline");var e=c[i].indexOf("_");var f=c[i].substring(d+8,e);var g=eval("Node"+f);goalPrvNode[goalPrvNode.length]="Node"+f+"$$"+g.fillcolor+","+g.id+"$$"+g.firstChild.color2;g.fillcolor="#f8feb0";g.firstChild.color2="#fad01e"}}}function CancelPrvNextNode(){var e="";var f="";var g="";var h="";for(i=0;i<goalPrvNode.length;i++){cancelNodeError(goalPrvNode[i])}for(i=0;i<goalNextNode.length;i++){cancelNodeError(goalNextNode[i])}function cancelNodeError(a){f=a.split(",");for(j=0;j<f.length;j++){g=f[j].split("$$");var b=g[0];var c=eval(b);var d=g[1];if(c.tagName=="polyline"){c.strokecolor=d}else{if(j==0){c.fillcolor=d}else{c.firstChild.color2=d}}}}goalPrvNode=new Array();goalNextNode=new Array()}var PrvNodeObj;var CurNodeid="";var goalsNum=0;var EndNodeArray=new Array();function play(){goalsNum=0;goalendNum=1;setTimeout("PlayNode()",1000)}function PlayTrace(){goalsNum=0;if(EndNodeList==""){return false}for(i=0;i<document.all.length;i++){var a=document.all(i);var b=a.tagName;if(b=="Oval"&&a.NodeType=="StartNode"){EndNodeList=a.Nodeid+","+EndNodeList}}EndNodeArray=EndNodeList.split(",");CancelCurNodeid();PlayNode()}function CancelCurNodeid(){if(CurrentNodeid=="")return false;for(var i=0;i<document.all.length;i++){var a=document.all(i);if((","+CurrentNodeid+",").indexOf(","+a.Nodeid+",")!=-1){a.fillcolor=EndNodeColor1;a.firstChild.color2=EndNodeColor2;a.strokeweight=1.30}}}function HightLightCurNodeid(){if(CurrentNodeid=="")return false;for(var i=0;i<document.all.length;i++){var a=document.all(i);if((","+CurrentNodeid+",").indexOf(","+a.Nodeid+",")!=-1){a.fillcolor=CurrentNodeColor1;a.firstChild.color2=CurrentNodeColor2;a.strokeweight=1.30}}}function PlayNode(){if(PrvNodeObj){PrvNodeObj.fillcolor=EndNodeColor1;PrvNodeObj.firstChild.color2=EndNodeColor2;PrvNodeObj.strokeweight=1.2;if(PrvNodeObj.tagName=="polyline"){PrvNodeObj.strokecolor="black";PrvNodeObj.strokeweight=".9pt"}}if(goalsNum<EndNodeArray.length){CurNodeid=EndNodeArray[goalsNum]}else{HightLightCurNodeid();return false}try{for(var i=0;i<document.all.length;i++){var a=document.all(i);if(a.Nodeid==CurNodeid){a.fillcolor=CurrentNodeColor1;a.firstChild.color2=CurrentNodeColor2;a.strokeweight=1.50;PrvNodeObj=a;if(a.tagName=="polyline"){a.strokecolor="red"}}}}catch(e){alert(e.message)}goalsNum++;setTimeout("PlayNode()",1000)}Ext.onReady(function(){var q=parent.processid;var r="";var s=parent.docUnid;Ext.get("div1").on('contextmenu',function(e){if((event.srcElement.parentElement.id=="div1"||event.srcElement.parentElement.parentElement.id=="div1")){var j;if(event.srcElement.parentElement.id=="div1"){j=event.srcElement}else{j=event.srcElement.parentElement}var k=j.Nodeid;if(k==undefined){return}var l=new Ext.menu.Menu();Ext.menu.initMenu(l);if(j.NodeType=="Activity"){var m="page?wf_num=P_S003_001&DocUnid="+parent.docUnid+"&Nodeid="+k;if(j.fillcolor!=OrNodeColor){l.add(new Ext.menu.Item({text:wflang.show_msg01,url:m,handler:ShowNodeRemark}))}else{l.add(new Ext.menu.Item({text:wflang.show_msg01,disabled:true}))}if(j.fillcolor==CurrentNodeColor1){var n=new Ext.menu.Item({text:wflang.show_msg02,menu:{items:[]}});Ext.Ajax.request({url:'rule?wf_num=R_S003_B047',method:'POST',success:function(a,b){var c=Ext.util.JSON.decode(a.responseText);var d=c.item.split(",");for(i=0;i<d.length;i++){var e=d[i];var f=new Ext.menu.Item({text:e,icon:'linkey/bpm/images/icons/user_green.gif'});n.menu.add(f)}},params:{Processid:q,DocUnid:s,Nodeid:k,Action:'Current'}});l.add(n)}if(j.fillcolor==CurrentNodeColor1||j.fillcolor==EndNodeColor1){var o=new Ext.menu.Item({text:wflang.show_msg03,menu:{items:[]}});Ext.Ajax.request({url:'rule?wf_num=R_S003_B047',method:'POST',success:function(a,b){var c=Ext.util.JSON.decode(a.responseText);var d=c.item.split(",");for(i=0;i<d.length;i++){var e=d[i];if(e=="")e=wflang.show_msg04;var f=new Ext.menu.Item({text:e,icon:'linkey/bpm/images/icons/user_green.gif'});o.menu.add(f)}},params:{Processid:q,DocUnid:s,Nodeid:k,Action:'End'}});l.add(o)}}if(j.NodeType=="SubProcess"){if(j.fillcolor!=OrNodeColor){var p=new Ext.menu.Item({text:wflang.show_msg05,menu:{items:[]}});var m='rule?wf_num=R_S003_B063';Ext.Ajax.request({url:m,method:'POST',success:function(a,b){var c=Ext.util.JSON.decode(a.responseText);var d=c.item.split(",");for(i=0;i<d.length;i++){var e=d[i].split("$");var f=e[0];var g=e[1];var h=new Ext.menu.Item({text:f,icon:'linkey/bpm/images/icons/doclist.gif',url:g,handler:ShowSubDoc});if(f==wflang.show_msg06){h.setDisabled(true)}p.menu.add(h)}},params:{Processid:q,DocUnid:s,Nodeid:k,wf_appid:top.GetUrlArg("WF_Appid")}})}else{var p=new Ext.menu.Item({text:wflang.show_msg05,disabled:true})}l.add(p)}l.add(new Ext.menu.Item({text:wflang.show_msg07,handler:function(){ShowPrvNode(j)}}));l.add(new Ext.menu.Item({text:wflang.show_msg08,handler:function(){ShowNextNode(j)}}));e.preventDefault();l.showAt(e.getXY())}});InitNode();setTimeout(function(){try{parent.Ext.get('loading').remove();Ext.fadeInit();parent.Ext.get('loading-mask').fadeOut({remove:true})}catch(e){}},150)});function ShowNodeRemark(a){OpenUrl(a.url,300,300)}function ShowSubDoc(a){OpenUrl(a.url,100,100)}